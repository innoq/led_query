# encoding: utf-8
#META infer: <%= !!include_descendants %>

PREFIX dct:<http://purl.org/dc/terms/>
PREFIX skos:<http://www.w3.org/2004/02/skos/core#>
PREFIX qb:<http://purl.org/linked-data/cube#>
PREFIX led:<http://data.uba.de/led/>
PREFIX xsd:<http://www.w3.org/2001/XMLSchema#>
PREFIX dcat:<http://www.w3.org/ns/dcat#>

SELECT (COUNT(DISTINCT(?obs)) AS ?obsCount)  ?label (led:bodendaten as ?dataset) WHERE {
    <%= render.call("_concepts_query",
            :concepts_by_dimension => concepts_by_dimension,
            :include_descendants => include_descendants) %>
    ?obs led:source led:bodenportal .
    ?obs a qb:Observation .
    <%= render.call('_temporal_query', :temporal => temporal) if temporal.valid? %>
    <%= render.call('_keywords_query', :keywords => keywords) unless keywords.empty? %>
    <%= render.call('_title_query', :title => title) if title.present? %>
    OPTIONAL { led:bodenportal skos:prefLabel ?label }

} GROUP BY ?label 
